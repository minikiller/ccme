language: java
jdk: oraclejdk11
#install: true
#script: mvn clean install
dist: trusty
sudo: false
addons:
  ssh_known_hosts:
  - "192.119.116.101"
services:
  - docker
before_install:
- openssl aes-256-cbc -K $encrypted_db2095f63ba3_key -iv $encrypted_db2095f63ba3_iv
  -in .travis/deploy_rsa.enc -out .travis/id_rsa -d
- eval "$(ssh-agent -s)"
- cp .travis/id_rsa ~/.ssh/deploy_rsa
- chmod 600 ~/.ssh/deploy_rsa
- ssh-add ~/.ssh/deploy_rsa

before_deploy:
- docker build -t kalix/femd marketdata
- docker run -d -p 127.0.0.1:9880:9880 kalix/femd
- docker ps -a
- docker build -t kalix/feme matchingengine
- docker run -d -p 8323:8323 kalix/feme
- docker ps -a

deploy:
- provider: script
  skip_cleanup: true
  script: bash .travis/deploy.sh
  verbose: true
  on:
    branch: main
#    all_branches: true
cache:
  directories:
  - "$HOME/.m2"
